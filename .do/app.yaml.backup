name: smart-en-system-backend
services:
  - name: backend
    source_dir: backend
    github:
      repo: dzikrirazzan/turnover_api
      branch: main
      deploy_on_push: true
    build_command: pip install -r requirements.txt
    run_command: gunicorn --worker-tmp-dir /dev/shm turnover_prediction.wsgi:application
    environment_slug: python
    instance_count: 1
    instance_size_slug: basic-xxs
    http_port: 8080
    envs:
      - key: DEBUG
        value: "False"
      - key: SECRET_KEY
        value: "${APP_SECRET_KEY}"
        type: SECRET
      - key: ALLOWED_HOSTS
        value: "${APP_DOMAIN},localhost,127.0.0.1"
      - key: MYSQL_DATABASE
        value: "${DATABASE_NAME}"
      - key: MYSQL_USER
        value: "${DATABASE_USER}"
      - key: MYSQL_PASSWORD
        value: "${DATABASE_PASSWORD}"
        type: SECRET
      - key: MYSQL_HOST
        value: "${DATABASE_HOST}"
      - key: MYSQL_PORT
        value: "${DATABASE_PORT}"
      - key: DATABASE_URL
        value: "${DATABASE_URL}"
      - key: CORS_ALLOWED_ORIGINS
        value: "https://your-frontend-domain.com,http://localhost:3000"

databases:
  - name: smart-en-db
    engine: MYSQL
    version: "8"
    production: false
    cluster_name: smart-en-cluster

alerts:
  - rule: CPU_UTILIZATION
  - rule: MEM_UTILIZATION
